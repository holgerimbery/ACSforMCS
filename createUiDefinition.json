{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "basics": {
        "description": "Deploy Azure Communication Services for Microsoft Copilot Studio with all required resources. This template creates a complete, production-ready environment for voice call automation using Azure Communication Services and Microsoft Copilot Studio integration.",
        "location": {
          "label": "Region",
          "toolTip": "Select the Azure region where your resources will be deployed. Choose a region close to your users for best performance.",
          "resourceTypes": [
            "Microsoft.Web/serverfarms",
            "Microsoft.Web/sites",
            "Microsoft.KeyVault/vaults",
            "Microsoft.CognitiveServices/accounts"
          ]
        }
      }
    },
    "basics": [
      {
        "name": "projectName",
        "type": "Microsoft.Common.TextBox",
        "label": "Project Name",
        "placeholder": "agentvoice",
        "defaultValue": "agentvoice",
        "toolTip": "Base name for all resources (3-15 characters, lowercase letters and numbers only). A random 6-character suffix will be automatically added to ensure global uniqueness - no need to make this name unique yourself. Create your resource group with naming convention 'rg-{projectName}{suffix}-{environment}'.",
        "constraints": {
          "required": true,
          "regex": "^[a-z0-9]{3,15}$",
          "validationMessage": "Project name must be 3-15 characters long and contain only lowercase letters and numbers."
        }
      },
      {
        "name": "environment",
        "type": "Microsoft.Common.DropDown",
        "label": "Environment",
        "placeholder": "Select environment",
        "defaultValue": "Production",
        "toolTip": "Environment type for resource naming and configuration",
        "constraints": {
          "required": true,
          "allowedValues": [
            {
              "label": "Development",
              "value": "dev"
            },
            {
              "label": "Test",
              "value": "test"
            },
            {
              "label": "Staging",
              "value": "stage"
            },
            {
              "label": "Production",
              "value": "prod"
            }
          ]
        }
      }
    ],
    "steps": [
      {
        "name": "appServiceConfig",
        "label": "App Service Configuration",
        "elements": [
          {
            "name": "appServicePlanSku",
            "type": "Microsoft.Common.DropDown",
            "label": "App Service Plan SKU",
            "placeholder": "Select pricing tier",
            "defaultValue": "Basic B1 (Recommended for testing)",
            "toolTip": "Choose the App Service Plan pricing tier based on your performance and scaling needs",
            "constraints": {
              "required": true,
              "allowedValues": [
                {
                  "label": "Free F1 (Limited, good for development)",
                  "value": "F1"
                },
                {
                  "label": "Shared D1 (Limited, basic testing)",
                  "value": "D1"
                },
                {
                  "label": "Basic B1 (Recommended for testing)",
                  "value": "B1"
                },
                {
                  "label": "Basic B2 (Enhanced testing)",
                  "value": "B2"
                },
                {
                  "label": "Basic B3 (High-end testing)",
                  "value": "B3"
                },
                {
                  "label": "Standard S1 (Recommended for production)",
                  "value": "S1"
                },
                {
                  "label": "Standard S2 (Production with scaling)",
                  "value": "S2"
                },
                {
                  "label": "Standard S3 (High-volume production)",
                  "value": "S3"
                },
                {
                  "label": "Premium P1v2 (High performance)",
                  "value": "P1v2"
                },
                {
                  "label": "Premium P2v2 (Very high performance)",
                  "value": "P2v2"
                },
                {
                  "label": "Premium P3v2 (Maximum performance)",
                  "value": "P3v2"
                },
                {
                  "label": "Premium P1v3 (Latest high performance)",
                  "value": "P1v3"
                },
                {
                  "label": "Premium P2v3 (Latest very high performance)",
                  "value": "P2v3"
                },
                {
                  "label": "Premium P3v3 (Latest maximum performance)",
                  "value": "P3v3"
                }
              ]
            }
          },
          {
            "name": "enableApplicationInsights",
            "type": "Microsoft.Common.CheckBox",
            "label": "Enable Application Insights",
            "toolTip": "Enable Application Insights for monitoring, logging, and performance tracking (recommended for production)",
            "constraints": {
              "required": false
            }
          },
          {
            "name": "enableBackup",
            "type": "Microsoft.Common.CheckBox",
            "label": "Enable App Service Backup",
            "toolTip": "Enable automated backups for the App Service (requires Basic B1 or higher SKU)",
            "constraints": {
              "required": false
            },
            "visible": "[not(or(equals(steps('appServiceConfig').appServicePlanSku, 'F1'), equals(steps('appServiceConfig').appServicePlanSku, 'D1')))]"
          }
        ]
      },
      {
        "name": "azureServicesConfig",
        "label": "Azure Services Configuration",
        "elements": [
          {
            "name": "communicationServicesSku",
            "type": "Microsoft.Common.DropDown",
            "label": "Communication Services Pricing",
            "placeholder": "Select pricing tier",
            "defaultValue": "Free F0 (Good for testing)",
            "toolTip": "Choose the Azure Communication Services pricing tier",
            "constraints": {
              "required": true,
              "allowedValues": [
                {
                  "label": "Free F0 (Good for testing)",
                  "value": "F0"
                },
                {
                  "label": "Standard S0 (Pay-as-you-go for production)",
                  "value": "S0"
                }
              ]
            }
          },
          {
            "name": "cognitiveServicesSku",
            "type": "Microsoft.Common.DropDown",
            "label": "Speech Services Pricing",
            "placeholder": "Select pricing tier",
            "defaultValue": "Free F0 (Good for testing)",
            "toolTip": "Choose the Cognitive Services Speech pricing tier for voice processing",
            "constraints": {
              "required": true,
              "allowedValues": [
                {
                  "label": "Free F0 (Good for testing)",
                  "value": "F0"
                },
                {
                  "label": "Standard S0 (Pay-as-you-go for production)",
                  "value": "S0"
                }
              ]
            }
          }
        ]
      },
      {
        "name": "optionalConfig",
        "label": "Optional Configuration",
        "elements": [
          {
            "name": "configurationNote",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "The following settings are optional and can be configured after deployment using the provided PowerShell scripts."
            }
          },
          {
            "name": "agentPhoneNumber",
            "type": "Microsoft.Common.TextBox",
            "label": "Agent Phone Number (Optional)",
            "placeholder": "+1234567890",
            "toolTip": "Enter here if you already have a direct routing phone number in E.164 format (e.g., +1234567890). If you plan to purchase a number directly from Microsoft, leave empty and configure later using setup-configuration.ps1",
            "constraints": {
              "required": false,
              "regex": "^(\\+[1-9]\\d{1,14})?$",
              "validationMessage": "Phone number must be in E.164 format (e.g., +1234567890) or leave empty to configure later."
            }
          },
          {
            "name": "directLineSecret",
            "type": "Microsoft.Common.PasswordBox",
            "label": {
              "password": "DirectLine Secret (Optional)",
              "confirmPassword": "Confirm DirectLine Secret"
            },
            "toolTip": "DirectLine secret from Bot Framework. Can be configured later using setup-configuration.ps1",
            "constraints": {
              "required": false
            },
            "options": {
              "hideConfirmation": false
            }
          },
          {
            "name": "userObjectId",
            "type": "Microsoft.Common.TextBox",
            "label": "Your Azure AD Object ID (Optional)",
            "placeholder": "12345678-1234-1234-1234-123456789abc",
            "toolTip": "Your Azure AD Object ID for Key Vault access. Get this from: Azure Portal > Azure Active Directory > Users > [Your User] > Object ID. Leave empty if you're not sure - you can add access later.",
            "constraints": {
              "required": false,
              "regex": "^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})?$",
              "validationMessage": "Must be a valid GUID format (e.g., 12345678-1234-1234-1234-123456789abc) or leave empty."
            }
          },
          {
            "name": "postDeploymentNote",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "After deployment, download the latest release package from GitHub and use the included PowerShell scripts to complete configuration and deploy your application code."
            }
          }
        ]
      }
    ],
    "outputs": {
      "projectName": "[basics('projectName')]",
      "environment": "[basics('environment')]",
      "location": "[location()]",
      "appServicePlanSku": "[steps('appServiceConfig').appServicePlanSku]",
      "communicationServicesSku": "[steps('azureServicesConfig').communicationServicesSku]",
      "cognitiveServicesSku": "[steps('azureServicesConfig').cognitiveServicesSku]",
      "enableApplicationInsights": "[steps('appServiceConfig').enableApplicationInsights]",
      "enableBackup": "[steps('appServiceConfig').enableBackup]",
      "agentPhoneNumber": "[steps('optionalConfig').agentPhoneNumber]",
      "directLineSecret": "[steps('optionalConfig').directLineSecret]",
      "userObjectId": "[steps('optionalConfig').userObjectId]"
    }
  }
}